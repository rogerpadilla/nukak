# Changelog

All notable changes to this project will be documented in this file. Please add new changes to the top.

date format is [yyyy-mm-dd]

## [3.7.8] - 2026-01-04
### Refined AutoSync Safety
- **Transparent Safety Feedback**: In safe mode, `autoSync` now explicitly logs detailed messages via the new `skippedMigration` log level for skipped column alterations and drops, providing developers with clear visibility into pending schema changes that require manual intervention or migration.

 ## [3.7.7] - 2026-01-04
 ### Refined Foreign Key Handling & Control
 - **Recursive Type Inheritance**: Foreign key columns now automatically inherit the exact SQL type of their referenced primary keys (e.g., `UUID` -> `UUID`), ensuring perfect compatibility even in complex inheritance or self-referencing relationships.
 - **Custom Foreign Key Control**: Introduced the `foreignKey` option in `@Field` and `@Id` to allow specifying custom semantic names for constraints or disabling physical constraints (`false`) while maintaining logical references.
 - **Deterministic Constraint Naming**: Standardized default foreign key naming to `` `fk_${tableName}_${columnName}` ``, ensuring uniqueness and predictability across the database.
 - **Enhanced Schema Robustness**: Improved the schema generator's resilience against entities using circular dependencies or deep inheritance chains.
 - **Express Middleware Fix**: Resolved an issue in `query.util.ts` where the query parser could crash when receiving array-based query parameters (e.g., `$where[]=1`), preventing correct filtering in Express applications.
 - **Field Utility Optimization**: Refactored `isNumericType` to use a `Set` for O(1) lookups and resolved strict type checking issues in `field.util.ts`.

 ## [3.7.5] - 2026-01-04
 ### Enhanced Type Inference & Default Value Comparison
 - **Strict Field Type Safety**: Standardized the `type` property in `@Field` and `@Id` to use a strict union of global constructors (`String`, `Number`, etc.) and verified `ColumnType` strings.
 - **Removed String Aliases**: Deprecated and removed support for informal string aliases like `'string'`, `'number'`, `'boolean'`, and `'date'` in the `type` property. Developers should use the corresponding TypeScript constructors for logical mapping.
 - **Semantic Type Inference**: Added robust support for `'uuid'`, `'json'`, `'jsonb'`, and `'vector'` as valid semantic values for the `type` property. This ensures correct cross-database SQL mapping even when specified as semantic strings.

 ## [3.7.4] - 2026-01-04
 ### Enhanced Schema Generation & Type Safety
 - **Fixed Foreign Key Type Mismatch**: Resolved an issue where foreign key columns could default to incompatible types (e.g., `TEXT`) when referencing primary keys of a different type (e.g., `UUID`). Foreign keys now automatically inherit the exact SQL type of the column they reference.
 - **Improved Default Value Comparison**: Standardized default value normalization to handle complex PostgreSQL type casts (e.g., `'[]'::jsonb[]`) and accurately compare object/array defaults using `JSON.stringify`, effectively eliminating "phantom diffs."
 - **Improved Primary Key Inference**: String-based primary keys (including UUIDs) no longer incorrectly default to `BIGINT` auto-incrementing serials. The ORM now only applies auto-increment logic to numeric types (`number`, `BigInt`) unless explicitly configured via `@Id({ autoIncrement: true })`.
 - **Architectural Refactor**: Consolidated schema generation to use a unified `fieldToColumnSchema` path for both initial creation and synchronization, ensuring perfect structural consistency and eliminating "phantom diffs".
 - **Reusable Field Utilities**: Created `field.util.ts` for centralized logic regarding auto-increment and numeric type checks, improving maintainability across the ORM.
 - **Safety Fix**: Refined `generateColumnDefinitionFromSchema` to safely strip redundant `PRIMARY KEY` constraints during `ALTER TABLE` operations, avoiding "Duplicate Primary Key" errors while maintaining auto-incrementing properties.
 - **Expanded Unit Tests**: Added comprehensive branch testing for field properties and type inference to ensure long-term stability across all 8 supported databases.

 ## [3.7.3] - 2026-01-04
### Robust Schema Synchronization
- **Safe AutoSync**: Primary keys are now immune to automated alterations, preventing dangerous schema changes and ensuring database stability.
- **Modern Primary Keys**: Standardized on **64-bit** auto-increment primary keys across all SQL dialects to align with TypeScript's `number` type:
  - **PostgreSQL**: Now uses `BIGINT GENERATED BY DEFAULT AS IDENTITY` (SQL Standard).
  - **MySQL / MariaDB**: Now uses `BIGINT UNSIGNED AUTO_INCREMENT`.
  - **SQLite / LibSQL / D1**: Consistently uses 64-bit `INTEGER PRIMARY KEY`.
- **SQLite `STRICT` Mode**: Tables generated for SQLite, LibSQL, and Cloudflare D1 now use **`STRICT` mode** by default, enforcing type integrity at the database level.
- **Polymorphic Type Resolution**: Refactored `getSqlType` to be dialect-aware for all core types (Numbers, Strings, Booleans, Dates), preventing dialect-specific types from leaking into incompatible databases.
- **Semantic Type Comparison**: Implemented intelligent type normalization that understands dialect-specific aliases (e.g., `INTEGER` vs `INT`) and ignores implementation details like MySQL display widths (`BIGINT(20)`).
- **Fixed ALTER Syntax**: Resolved "Duplicate primary key" errors in MySQL/MariaDB by ensuring `MODIFY COLUMN` statements omit existing constraints during type or nullability updates.
- **Improved Postgres Introspection**: Enhanced default value comparison to correctly handle complex Postgres type casts (e.g., `::timestamp without time zone`) and quoted strings.
- **Expanded Testing**: Added **SQLite**, **LibSQL**, and **Cloudflare D1** scenarios to the integration test suite, ensuring 100% behavioral consistency across all 8 supported databases.
- **Predictable Test Assertions**: Refactored all schema synchronization and introspection tests to use direct, non-conditional assertions, improving test reliability and failure clarity by removing optional chaining and non-null assertions.
- **Clean Test Logic**: Removed imperative conditionals from test generators, replacing them with declarative mapping objects for dialect-specific type verification.

## [3.7.2] - 2026-01-04
### Improve documentation
- **AutoSync**: Clarified that entities must be imported/loaded before calling `autoSync()`. Added examples for both explicit entity passing (recommended) and auto-discovery approaches, plus debugging tips

## [3.7.1] - 2026-01-04
### Improve documentation
- Update examples in docs and improve formatting of README

## [3.7.0] - 2026-01-04
### Improvements
- **Repository Pattern Removal**: Removed the built-in Repository pattern implementation (`GenericRepository`, etc.) to simplify the framework architecture (KISS). Users should rely on the `Querier` interface or implement custom layers if needed.
- **Testing**: Added comprehensive tests for `HttpQuerier` and integration tests for the CLI entry point (`bin.ts`), achieving >99% code coverage.

## [3.6.1] - 2026-01-04
### New Features
- **CLI**: Added `--config` / `-c` flag to `uql-migrate` to load a custom configuration file.
- **CLI**: Improved error handling when loading configuration files (syntax errors are no longer swallowed).

## [3.6.0] - 2026-01-04
### New Features
- **CLI**: Added default logger, support to log slow-queries in a parameterized way, and ability to define custom loggers.

## [3.5.0] - 2026-01-03
### Refactor
- **Dialect-Aware String Defaults**: Optimized default column types for TypeScript `string` fields across all supported databases.
  - **PostgreSQL**: Defaults to `TEXT` (idiomatic, no length limits, slightly faster).
  - **SQLite**: Defaults to `TEXT` (matches internal type affinity).
  - **MySQL / MariaDB**: Defaults to `VARCHAR(255)` (ensures out-of-the-box compatibility for indices and unique constraints).
  - Automatically transitions to `VARCHAR(n)` when an explicit `length` is provided in the `@Field()` decorator.

## [3.4.1]
### Improve documentation

- Update examples in docs

## [3.1.1](https://github.com/rogerpadilla/uql/compare/@uql/core@3.1.0...@uql/core@3.1.1) (2025-12-30)
### Bug Fixes
* adjust relative paths for README and CHANGELOG in copyfiles script ([741c2ee](https://github.com/rogerpadilla/uql/commit/741c2ee8839376ca89a860a53950ef6b6d234596))

## [3.1.0](https://github.com/rogerpadilla/uql/compare/@uql/core@3.0.0...@uql/core@3.1.0) (2025-12-30)
### Bug Fixes

* adjust relative paths for README and CHANGELOG in copyfiles script ([7a61a01](https://github.com/rogerpadilla/uql/commit/7a61a0135da2d0459e588cda7d94f324bb9eebca))

## [3.0.0](https://github.com/rogerpadilla/uql/compare/@uql/core@2.0.0...@uql/core@3.0.0) (2025-12-30)
Reflect major changes in the package structure and dependencies.

## [2.0.0] - 2025-12-29
- **Major Rebranding**: Rebranded the project from **Nukak** to **UQL** (Universal Query Language - this was the original name!).
  - New Slogan: **"One Language. Frontend to Backend."**
  - Project homepage: [uql.app](https://uql.app).
- **Package Unification**: Unified all database adapters (`mysql`, `postgres`, `maria`, `sqlite`, `mongo`) and `express` middleware into a single core package: `@uql/core`.
- **Scoped Naming**:
  - `@uql/core`: The main ORM engine and all database adapters.
  - `@uql/migrate`: The database migration system (formerly `nukak-migrate`).
- **Improved API Surface**:
  - Database-specific logic is now accessible via sub-paths (e.g., `import { ... } from '@uql/core/postgres'`).
  - Unified `NamingStrategy` and `QueryContext` across all unified adapters.
- **Build & Distribution**:
  - Integrated `bunchee` for high-performance browser bundle generation (`@uql/core/browser`).
  - Minimized core dependency footprint by moving database drivers to optional `peerDependencies`.
- **Enhanced Type Safety**: Fully updated internal type resolution to support the unified package structure.

## [1.8.0] - 2025-12-29
- **New Feature**: Added support for **Naming Strategies**.
  - Automatically translate TypeScript entity and property names to database-specific identifiers (e.g., camelCase to snake_case).
  - Built-in `DefaultNamingStrategy` and `SnakeCaseNamingStrategy`.
  - Comprehensive support across all SQL dialects and MongoDB.
- **Refactoring**:
  - Unified naming and metadata resolution logic into a new `AbstractDialect` base class shared by both DML (Dialects) and DDL (Schema Generators).
  - Improved `MongoDialect` to respect naming strategies for collection and field names on both read and write operations.

## [1.7.0] - 2025-12-29
- **New Package**: Introduced `nukak-migrate` for database migrations.
  - Supports version-controlled schema changes via local migration files.
  - Automatic migration generation from entity definitions using schema introspection.
  - Full support for PostgreSQL, MySQL, MariaDB, and SQLite.
  - CLI tool for managing migrations (`up`, `down`, `status`, `generate`, `sync`).
  - Database-backed migration tracking (Database or JSON storage).
- **Core Improvements**:
  - Expanded `@Field()` decorator with schema metadata: `length`, `precision`, `scale`, `unique`, `index`, `columnType`, `defaultValue`, and `comment`.
  - Added schema generation and introspection capabilities to SQL dialects.

## [1.6.0] - 2025-12-28
- **Architectural Change**: Migrated from "Values as Parameter" to "Context Object" pattern for SQL generation.
  - This pattern centralizes query parameters and SQL fragments into a `QueryContext`, ensuring robust placeholder management and preventing out-of-sync parameter indices.
  - Improved compatibility with PostgreSQL's indexed placeholders ($1, $2, etc.) and complex sub-queries.
  - Standardized dialect interfaces to operate directly on the `QueryContext` for higher performance and cleaner code.
- Fixed linter issues and unified type safety for `raw()` SQL snippets across all drivers.

## [1.5.0] - 2025-12-28
- **BREAKING CHANGE**: Implemented "Sticky Connections" for performance. `Querier` instances now hold their connection until `release()` is explicitly called.
  - If you manually retrieve a querier via `pool.getQuerier()`, you **MUST** call `await querier.release()` when finished, otherwise connections will leak.
  - `Repositories` and `pool.transaction(...)` callbacks automatically handle this, so high-level usage remains unchanged.
- Unified serialization logic: `@Serialized()` decorator is now centralized in `AbstractSqlQuerier`, removing redundant overrides in drivers.
- Fixed MongoDB consistency: `beginTransaction`, `commitTransaction`, and `rollbackTransaction` are now serialized to prevent race conditions.
- Fix Cross-Dialect SQL JSON bug by moving PostgreSQL-specific casts to the appropriate dialect.
- Fix transaction race conditions by serializing transaction lifecycle methods and implementing an internal execution pattern.

## [1.4.16] - 2025-12-28

- Implement a "Serialized Task Queue" at the core of the framework to ensure database connections are thread-safe and race-condition free.
- Introduce `@Serialized()` decorator to simplify the serialization of database operations across all drivers.

## [1.4.14] - 2025-12-28

- Robust `upsert` implementation across all SQL dialects (PostgreSQL, MySQL, MariaDB, SQLite).

## [1.4.10] - 2025-12-27

- Improve types, tests, migrate from EsLint/Prettier to Biome, and update dependencies.

## [1.4.6] - 2024-11-06

- Update dependencies and improve readme.

## [1.4.5] - 2024-09-26

- Imperative transactions have to be closed manually.

## [1.4.4] - 2024-09-26

- Ensure own connection is always released even if exception occurs.
- Correct issue when empty or null list is passed to `insertMany` operations.

## [1.4.3] - 2024-09-25

- Ensure the connection is auto-released after `commit` or `rollback` runs.
- Update dependencies.

## [1.4.2] - 2024-09-20

- Fix projection of `@OneToMany` field when the 'one' side produces empty result.
- Update dependencies.

## [1.4.1] - 2024-08-21

- Add nukak-maku logo.
- Update dependencies (functionality keeps the same in this release).

## [1.4.0] - 2024-08-15

- Automatically release the querier unless it is inside a current transaction.
- Remove unnecessary wrapper for transactions from `AbstractQuerierPool` class.

## [1.3.3] - 2024-08-13

- Improve typings of first inserted ID.

## [1.3.2] - 2024-08-13

- Return the inserted IDs in the response of the queriers' `run` function.

## [1.3.1] - 2024-08-13

- Fix an issue related to the `$where` condition of selected relations missed in the final criteria for `@OneToMany` and `@ManyToMany` relationships.

## [1.3.0] - 2024-08-13

- Add support for `json` and `jsonb` fields. Automatically parse the JSON values when persisting with `JSON.parse` function.
- Improve type-safety in general.
- Move `getPersistables` inside dialect for higher reusability.
- Add support for `vector` fields.

## [1.2.0] - 2024-08-12

- Add support for `raw` in values (previously, it was only supported by `$select` and `$where` operators). Allows safe use of any SQL query/clause as the value in an insert or update operation that shouldn't be automatically escaped by the ORM.

## [1.1.0] - 2024-08-11

- Add support for `upsert` operations.
- Migrate SQLite package driver from `sqlite3` to `better-sqlite3` for better performance.
- Make Maria package to use the `RETURNING id` clause to get the inserted IDs.

## [1.0.1] - 2024-08-10

- Rename `$project` operator to `$select` for consistency with most established frameworks so far.
- Rename `$filter` operator to `$where` for consistency with most established frameworks so far.

## [1.0.0] - 2024-08-10

- Allow to set a field as non-eager (i.e. lazy) with `eager: false` (by default fields are `eager: true`).
- Allow to set a field as non-updatable (i.e. insertable and read-only) with `updatable: false` (by default fields are `updatable: true`).

## [0.4.0] - 2023-11-06

- Move project inside query parameter [#63](https://github.com/rogerpadilla/nukak/pull/63)

## [0.3.3] - 2023-10-25

- Update usage example in the README.md.

## [0.3.2] - 2023-10-24

- Improve usage examples in the README.md, and make the overview section more concise.

## [0.3.1] - 2023-10-19

1. Remove `$group` and `$having` as they detriment type safety as currently implemented (support may be redesigned later if required).
2. Improve type safety of `$project` operator.
3. Improve type safety of `$filter` operator.
4. Remove projection operators (`$count`, `$min`, `$max`, `$min`, and `$sum`) as they detriment type safety as currently implemented. This can be done via Virtual fields instead as currently supported for better type safety.

## [0.3.0] - 2023-10-18

- Add support for `transaction` operations using a QuerierPool.
  Automatically wraps the code of the callback inside a transaction, and auto-releases the querier after running.
- Update dependencies.

  ```ts
  const ids = await pool.transaction(async (querier) => {
    const data = await querier.findMany(...);
    const ids = await querier.insertMany(...);
    return ids;
  });
  ```

## [0.2.21] 2023-04-15

- fix(nukak-browser): check if ids are returned before use $in to delete them.

- Reuse community open-source npm packages to escape literal-values according to each DB vendor.

## [0.2.0] 2023-01-02

- Move projection to a new parameter to improve type inference of the results.

- Support dynamic operations while projecting fields, and move `$project` as an independent parameter in the `find*` functions [#55](https://github.com/rogerpadilla/nukak/pull/55).
